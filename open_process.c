//
// Created by Aritra on 03/06/2024.
//

#include <stdio.h>
#include <Windows.h>

// HANDLE OpenProcess(DWORD dwDesiredAccess, WINBOOL bInheritHandle, DWORD dwProcessId)

int main(void){

    STARTUPINFOW startupinfow = { 0 };
    PROCESS_INFORMATION processInformation = { 0 };

    if (!CreateProcessW(
            L"C:\\Windows\\system32\\notepad.exe",
            NULL,
            NULL,
            NULL,
            FALSE,
            BELOW_NORMAL_PRIORITY_CLASS,
            NULL,
            NULL,
            &startupinfow,
            &processInformation
            )){

        printf("[-] Failed creating process. ErrCode: %ld\n", GetLastError());
        return EXIT_FAILURE;
    }

    printf("[+] Created process successfully. PID: %ld\n", processInformation.dwProcessId);

    HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, processInformation.dwProcessId);

    if (hProcess == NULL){
        printf("[-] Failed to open process. ErrCode: %ld\n", GetLastError());
        return EXIT_FAILURE;
    }

    printf("[+] Opened process successfully. PID: %ld\n", processInformation.dwProcessId);

    return 0;
}
